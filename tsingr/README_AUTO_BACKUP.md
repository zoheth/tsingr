# 自动备份功能使用说明

## 🎉 已实现功能

### ✅ 自动备份系统
应用现在具备完善的数据保护机制，确保你的学习数据安全！

## 🛡️ 自动保护机制

### 1. **启动时自动备份**
- 每次启动应用时自动创建备份
- 每天只备份一次（避免重复）
- 自动保留最近7天的备份

### 2. **数据版本迁移**
- 自动检测应用版本变化
- 兼容旧版本数据格式
- 升级时自动转换数据

### 3. **故障自动恢复**
- 数据加载失败时自动从备份恢复
- 保护你的学习进度不丢失

## 📱 如何使用

### 查看自动备份
1. 打开应用主页
2. 点击右上角 ⚙️ **设置**
3. 找到 📜 **自动备份管理**
4. 查看所有自动备份列表

### 恢复备份
在自动备份列表中：
1. 点击备份右侧的 **⋮** 菜单
2. 选择 **恢复此备份**
3. 确认恢复（智能合并）

### 删除备份
- **删除单个**：点击菜单 → 删除
- **删除全部**：点击对话框底部 **删除全部**

## 🔄 更新应用时的数据保护

### 你的数据会被保护！
```
应用启动
  ↓
检测版本变化
  ↓
自动迁移数据格式（如需要）
  ↓
创建自动备份
  ↓
如果出错 → 从最近备份恢复
  ↓
正常使用 ✅
```

### 多层保护：
1. ✅ **SharedPreferences 持久化**（应用更新时保留）
2. ✅ **自动备份**（每天一次，保留7天）
3. ✅ **手动导出**（永久保存）
4. ✅ **版本迁移**（自动兼容旧数据）

## 📂 备份存储位置

### Android
```
/data/data/com.tsingr.app/files/backups/
├── auto_backup_2025-01-15.json
├── auto_backup_2025-01-14.json
└── ...
```

### iOS
```
~/Library/Application Support/backups/
├── auto_backup_2025-01-15.json
└── ...
```

### Windows
```
C:\Users\用户名\AppData\Roaming\tsingr\backups\
```

## 🆚 自动备份 vs 手动导出

| 功能 | 自动备份 | 手动导出 |
|------|---------|---------|
| 触发方式 | 自动（每次启动） | 手动点击 |
| 保留时间 | 7天 | 永久 |
| 存储位置 | 应用目录（隐藏） | 用户选择 |
| 用途 | 短期保护 | 长期存档、跨设备 |
| 卸载后 | 删除 | 保留 |

**建议：**
- 日常使用：依赖自动备份
- 长期保存：每周手动导出一次
- 更换设备：必须手动导出/导入

## ⚠️ 重要提示

### ✅ 数据会保留的情况
- 应用商店更新 ✅
- APK覆盖安装 ✅
- 应用崩溃/重启 ✅

### ❌ 数据会丢失的情况
- **卸载应用** ❌
- 清除应用数据 ❌
- 恢复出厂设置 ❌

**解决方案：** 重装前务必手动导出！

## 💡 最佳实践

### 日常使用
```
正常使用应用
  ↓
自动备份（无需操作）
  ↓
安心学习 ✅
```

### 定期维护（推荐每周一次）
```
1. 设置 → 导出学习数据
2. 保存到云盘（坚果云/OneDrive）
3. 继续使用
```

### 重装应用/更换设备
```
旧设备：
1. 设置 → 导出学习数据
2. 上传到云盘

新设备：
1. 安装应用
2. 设置 → 导入学习数据
3. 选择：智能合并
4. 完成！
```

## 🧪 测试自动备份

### 验证自动备份工作正常：
1. 打开应用，添加一些笔记
2. 关闭应用
3. 重新打开应用
4. 设置 → 自动备份管理
5. 应该看到今天的备份 ✅

### 测试自动恢复：
1. 导出一份手动备份（以防万一）
2. 清除应用数据
3. 重新打开应用
4. 查看是否自动恢复数据

## 📊 备份统计

在自动备份管理页面可以看到：
- 📅 备份日期
- 📦 记录数量
- 💾 文件大小
- 🕐 创建时间

## 🔧 高级功能

### 备份文件格式
自动备份使用标准JSON格式：
```json
{
  "version": "1.0.0",
  "exportTime": "2025-01-15T10:30:00.000Z",
  "recordCount": 100,
  "records": { ... }
}
```

### 可以手动操作
虽然文件存储在应用目录，但你可以：
1. 使用文件管理器访问（需root/越狱）
2. 通过adb pull提取（Android）
3. 通过iTunes提取（iOS）

## ❓ 常见问题

### Q: 自动备份会占用多少空间？
A: 每个备份文件约20-100KB，7天备份约1MB以内

### Q: 我可以手动创建自动备份吗？
A: 不需要！每次启动应用时自动创建

### Q: 自动备份会影响性能吗？
A: 不会，备份过程在后台进行，几乎无感知

### Q: 自动备份和手动导出有什么区别？
A: 自动备份是短期保护，手动导出适合长期存档和跨设备同步

### Q: 更新应用后数据还在吗？
A: 在！有三重保护：
   1. SharedPreferences（主存储）
   2. 自动备份（恢复用）
   3. 版本迁移（兼容性）

### Q: 如果我忘记导出，卸载了应用怎么办？
A: 自动备份也会被删除 😢 所以建议定期手动导出到云盘

## 🎯 总结

### 你的数据现在有：
1. ✅ **主存储**：SharedPreferences
2. ✅ **自动备份**：7天滚动备份
3. ✅ **手动导出**：永久存档
4. ✅ **版本迁移**：自动兼容
5. ✅ **故障恢复**：自动恢复

### 建议操作：
- ✅ 日常：什么都不用管，自动保护
- ✅ 每周：手动导出一次到云盘
- ✅ 更换设备前：必须手动导出

**你的学习数据现在非常安全！** 🎉
